<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gtech Mobile</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%); background-size: 300% 300%; animation: bgGradient 18s ease infinite; color: #fff; min-height: 100vh; overflow-x: hidden; }
        @keyframes bgGradient { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        .header{display:flex;align-items:center;justify-content:space-between;padding:20px;background:rgba(255,255,255,0.05);backdrop-filter:blur(10px)}
        .logo-section{display:flex;align-items:center;gap:15px}
        .logo{width:40px;height:40px;background:linear-gradient(45deg,#667eea,#764ba2);border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer}
        .header-text{color:#a0a0a0;font-size:14px;text-transform:uppercase;letter-spacing:1px}
        .header-actions{display:flex;gap:15px}
        .header-btn{background:none;border:none;color:#fff;font-size:18px;cursor:pointer;padding:5px}
        .user-info{text-align:center;padding:30px 20px}
        .user-name{font-size:32px;font-weight:800;margin-bottom:20px;text-transform:uppercase}
        .balance-section{display:flex;flex-direction:column;gap:10px;margin-bottom:30px}
        .balance-item{display:flex;align-items:center;justify-content:center;gap:10px;font-size:18px;color:#a0a0a0}
        .coin-icon,.ticket-icon{width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px}
        .coin-icon{background:linear-gradient(45deg,#f39c12,#f1c40f);border-radius:50%}
        .ticket-icon{background:linear-gradient(45deg,#e67e22,#f39c12);border-radius:4px}
        .balance-value{color:#f39c12;font-weight:800;text-shadow:0 0 12px rgba(243,156,18,.35),0 0 32px rgba(243,156,18,.2)}
        .main-actions{padding:0 20px;display:flex;flex-direction:column;gap:15px;margin-bottom:30px}
        .action-btn{background:linear-gradient(45deg,#8b4513,#d2691e);border:none;border-radius:20px;padding:18px 30px;color:#fff;font-size:16px;font-weight:800;text-transform:uppercase;cursor:pointer;display:flex;align-items:center;gap:15px;transition:all .3s ease;position:relative;overflow:hidden;box-shadow:0 10px 20px rgba(0,0,0,.25)}
        .action-btn.gift-btn{background:linear-gradient(45deg,#2c3e50,#34495e)}
        .action-btn:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.3)}
        .action-btn::after{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(120deg,transparent 30%,rgba(255,255,255,.35) 50%,transparent 70%);transform:translateX(-100%);animation:shimmer 3.2s infinite;pointer-events:none}
        @keyframes shimmer{0%{transform:translateX(-120%)}60%,100%{transform:translateX(120%)}}
        .grid-section{padding:0 20px;display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:30px}
        .grid-item{background:rgba(255,255,255,.05);border-radius:20px;padding:30px 20px;text-align:center;cursor:pointer;transition:all .3s ease;min-height:140px;display:flex;flex-direction:column;justify-content:center;position:relative;overflow:hidden;box-shadow:0 10px 25px rgba(0,0,0,.25)}
        .grid-item:first-child{background:linear-gradient(135deg,#667eea,#764ba2)}
        .grid-item:last-child{background:linear-gradient(135deg,#f093fb,#f5576c)}
        .grid-item:hover{transform:translateY(-5px);box-shadow:0 15px 30px rgba(0,0,0,.3)}
        .grid-icon{font-size:24px;margin-bottom:15px}
        .grid-title{font-size:14px;font-weight:800;text-transform:uppercase;line-height:1.3}
        .bottom-actions{padding:0 20px 30px;display:flex;flex-direction:column;gap:15px}
        .bottom-btn{background:rgba(255,255,255,0.05);border:none;border-radius:20px;padding:18px 30px;color:#fff;font-size:16px;font-weight:800;text-transform:uppercase;cursor:pointer;display:flex;align-items:center;gap:15px;transition:all .3s ease;position:relative;overflow:hidden}
        .bottom-btn:hover{background:rgba(255,255,255,.1);transform:translateY(-2px)}
        .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px}
        .modal-content{background:linear-gradient(135deg,#2d2d2d,#1a1a1a);border-radius:25px;padding:30px;width:100%;max-width:420px;position:relative;animation:modalSlideIn .3s ease;border:1px solid rgba(255,255,255,.12);box-shadow:0 20px 60px rgba(0,0,0,.5)}
        @keyframes modalSlideIn{from{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}
        .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
        .modal-title{font-size:20px;font-weight:800;text-transform:uppercase}
        .close-btn{background:none;border:none;color:#fff;font-size:24px;cursor:pointer;padding:5px}
        .modal-subtitle{color:#a0a0a0;font-size:14px;text-align:center;margin-bottom:20px;line-height:1.5}
        .bonus-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
        .bonus-day{background:rgba(255,255,255,.05);border-radius:15px;padding:15px 10px;text-align:center;cursor:pointer;transition:all .3s ease;border:2px solid transparent}
        .bonus-day.active{background:rgba(241,196,15,.2);border-color:#f1c40f}
        .bonus-day.claimed{background:rgba(46,204,113,.2);border-color:#2ecc71}
        .bonus-day-number{font-size:12px;color:#a0a0a0;margin-bottom:5px}
        .bonus-reward{display:flex;align-items:center;justify-content:center;gap:5px;font-size:14px;font-weight:800}
        .timer-info{text-align:center;color:#a0a0a0;font-size:14px;margin-bottom:10px}
        .progress{width:100%;height:10px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden;margin:10px 0 20px 0;border:1px solid rgba(255,255,255,.12)}
        .progress-bar{height:100%;width:0%;background:linear-gradient(90deg,#f1c40f,#e67e22);box-shadow:0 0 20px rgba(241,196,15,.35);transition:width .6s ease}
        .leaderboard-item{display:flex;align-items:center;gap:15px;background:rgba(255,255,255,.05);border-radius:15px;padding:15px;margin-bottom:10px}
        .rank{font-size:16px;font-weight:800;color:#f39c12;min-width:30px}
        .player-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(45deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;font-size:12px}
        .player-info{flex:1}
        .player-name{font-weight:800;margin-bottom:2px}
        .player-score{display:flex;align-items:center;gap:5px;color:#f39c12;font-size:14px}
        .promo-form{margin-bottom:20px}
        .promo-input{width:100%;background:rgba(255,255,255,.1);border:2px solid rgba(255,255,255,.2);border-radius:15px;padding:15px;color:#fff;font-size:16px;margin-bottom:15px}
        .promo-input::placeholder{color:#666}
        .promo-submit{width:100%;background:linear-gradient(45deg,#2ecc71,#27ae60);border:none;border-radius:15px;padding:15px;color:#fff;font-size:16px;font-weight:800;cursor:pointer;text-transform:uppercase}
        .shop-categories{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;margin-bottom:30px}
        .shop-category{background:rgba(255,255,255,.05);border-radius:20px;padding:25px;text-align:center;cursor:pointer;transition:all .3s ease;min-height:120px;display:flex;flex-direction:column;justify-content:center;position:relative;overflow:hidden}
        .shop-category:nth-child(1){background:linear-gradient(135deg,#8b4513,#d2691e)}
        .shop-category:nth-child(2){background:linear-gradient(135deg,#3498db,#2980b9)}
        .shop-category:nth-child(3){background:linear-gradient(135deg,#9b59b6,#8e44ad)}
        .shop-category:nth-child(4){background:linear-gradient(135deg,#27ae60,#2ecc71)}
        .shop-category:hover{transform:translateY(-5px);box-shadow:0 15px 30px rgba(0,0,0,.3)}
        .shop-icon{font-size:24px;margin-bottom:10px}
        .shop-title{font-size:12px;font-weight:800;text-transform:uppercase;line-height:1.3}
        .download-section{padding:20px;display:flex;flex-direction:column;gap:15px}
        .download-btn{background:rgba(255,255,255,.1);border:none;border-radius:20px;padding:18px;color:#fff;font-size:16px;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all .3s ease;position:relative;overflow:hidden}
        .download-btn:hover{background:rgba(255,255,255,.2)}
        .telegram-btn{background:linear-gradient(45deg,#0088cc,#0066cc)}
        .appgallery-btn{background:linear-gradient(45deg,#c6426e,#e74c3c)}
        .rustore-btn{background:linear-gradient(45deg,#007bff,#0056b3)}
        .ripple{position:absolute;border-radius:50%;transform:scale(0);background:rgba(255,255,255,.35);animation:ripple 600ms linear;pointer-events:none}
        @keyframes ripple{to{transform:scale(3);opacity:0}}
        #effectsCanvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:2000}
        @media (max-width:400px){.grid-section{grid-template-columns:1fr}.bonus-grid{grid-template-columns:repeat(2,1fr)}.shop-categories{grid-template-columns:1fr}}
    </style>
    <script>
      // Basic accessibility: prevent focus outline removal; allow TAB focus
      document.addEventListener('keydown', (e) => { if (e.key === 'Tab') document.body.classList.add('show-focus'); });
    </script>
    <style>
      body.show-focus :focus { outline: 2px solid rgba(241,196,15,.8); outline-offset: 2px; }
    </style>
</head>
<body>
    <div id="mainScreen">
        <header class="header">
            <div class="logo-section">
                <div class="logo" id="logoClick" onclick="handleLogoClick()"><span style="font-size:20px">▲</span></div>
                <div class="header-text">Система<br>Активностей</div>
            </div>
            <div class="header-actions">
                <div id="adminIndicator" style="display:none" onclick="toggleAdminPanel()"><div class="admin-indicator">👑</div></div>
                <button class="header-btn">⋯</button>
                <button class="header-btn" onclick="closeApp()">✕</button>
            </div>
        </header>
        <div class="user-info">
            <div class="user-name" id="userName">ГОСТЬ</div>
            <div class="balance-section">
                <div class="balance-item"><span>ВАШ БАЛАНС:</span><div class="coin-icon">₽</div><span class="balance-value" id="balance">0</span></div>
                <div class="balance-item"><span>БИЛЕТОВ:</span><div class="ticket-icon">🎫</div><span class="balance-value" id="tickets">0</span></div>
            </div>
        </div>
        <div class="main-actions">
            <button class="action-btn" onclick="openModal('downloadModal')"><span class="action-icon">⬇</span>СКАЧАТЬ ИГРУ</button>
            <button class="action-btn gift-btn" onclick="openModal('bonusModal')"><span class="action-icon">🎁</span>ПОЛУЧИТЬ ПОДАРОК</button>
        </div>
        <div class="grid-section">
            <div class="grid-item" onclick="openModal('leaderboardModal')"><div class="grid-icon">📊</div><div class="grid-title">ТОП АКТИВНЫХ<br>ИГРОКОВ</div></div>
            <div class="grid-item" onclick="openModal('shopModal')"><div class="grid-icon">🛒</div><div class="grid-title">МАГАЗИН ИГРОВЫХ<br>ТОВАРОВ</div></div>
        </div>
        <div class="bottom-actions">
            <button class="bottom-btn" onclick="openModal('bonusModal')"><span class="action-icon">🎁</span>БОНУСНЫЕ МОНЕТЫ</button>
            <button class="bottom-btn" onclick="openStorage()"><span class="action-icon">📦</span>ХРАНИЛИЩЕ ПРЕДМЕТОВ</button>
            <button class="bottom-btn" onclick="openModal('promoModal')"><span class="action-icon">🏷️</span>ВВЕСТИ ПРОМОКОД</button>
        </div>
    </div>

    <div class="admin-panel" id="adminPanel" style="display:none">
        <div class="admin-title">👑 АДМИН ПАНЕЛЬ</div>
        <div class="detailed-stats">
            <div class="stat-row"><span>Всего пользователей:</span><span id="adminUserCount">0</span></div>
            <div class="stat-row"><span>Активных сегодня:</span><span id="adminActiveToday">0</span></div>
            <div class="stat-row"><span>Общий баланс:</span><span id="adminTotalBalance">0</span></div>
            <div class="stat-row"><span>Использовано промокодов:</span><span id="adminPromosUsed">0</span></div>
            <div class="stat-row"><span>Доступно промокодов:</span><span id="adminPromoCount">0</span></div>
        </div>
        <div class="admin-actions">
            <button class="admin-btn" onclick="showCreatePromo()">📝 Создать промокод</button>
            <button class="admin-btn" onclick="showUserManagement()">👥 Управление пользователями</button>
            <button class="admin-btn" onclick="showPromoManagement()">🎫 Управление промокодами</button>
            <button class="admin-btn" onclick="manageLeaderboard()">🏆 Управление лидербордом</button>
            <button class="admin-btn" onclick="showLinkManagement()">🔗 Управление ссылками</button>
            <button class="admin-btn" onclick="exportData()">📊 Экспорт данных</button>
            <button class="admin-btn" onclick="resetLeaderboard()" style="background:rgba(231,76,60,.3)">🔄 СБРОС ЛИДЕРБОРДА</button>
            <button class="admin-btn" onclick="toggleAdminPanel()" style="background:rgba(255,255,255,.1)">❌ Закрыть панель</button>
        </div>
    </div>

    <div class="modal" id="downloadModal"><div class="modal-content"><div class="modal-header"><div class="modal-title">КАК НАЧАТЬ ИГРАТЬ</div><button class="close-btn" onclick="closeModal('downloadModal')">✕</button></div><div class="modal-subtitle">ЧТОБЫ НАЧАТЬ ИГРАТЬ НА НАШЕМ ПРОЕКТЕ - НЕОБХОДИМО СКАЧАТЬ И УСТАНОВИТЬ ЛАУНЧЕР И ЗАПУСТИТЬ ЕГО, ВСЮ ЗАГРУЗКУ И УСТАНОВКУ ИГРЫ ЛАУНЧЕР СДЕЛАЕТ САМ</div><div class="modal-subtitle">СКАЧАЙ И УСТАНОВИ ЛАУНЧЕР, ДОЖДИСЬ ЗАГРУЗКИ ФАЙЛОВ И НАЧНИ ИГРАТЬ!</div><div class="download-section"><button class="download-btn telegram-btn" onclick="downloadTelegram()">📱 TELEGRAM</button><button class="download-btn appgallery-btn" onclick="downloadAppGallery()">📱 APP GALLERY</button><button class="download-btn rustore-btn" onclick="downloadRuStore()">📱 RUSTORE</button></div></div></div>

    <div class="modal" id="bonusModal"><div class="modal-content"><div class="modal-header"><div class="modal-title">БОНУСНЫЕ МОНЕТЫ</div><button class="close-btn" onclick="closeModal('bonusModal')">✕</button></div><div class="modal-subtitle">Заходите каждый день и забирайте бонусы.</div><div class="timer-info" id="bonusTimer">Бонус доступен сейчас!</div><div class="progress" aria-label="Прогресс серии бонусов"><div id="bonusProgressBar" class="progress-bar" style="width:0%"></div></div><div class="bonus-grid" id="bonusGrid"></div></div></div>

    <div class="modal" id="promoModal"><div class="modal-content"><div class="modal-header"><div class="modal-title">ВВЕСТИ ПРОМОКОД</div><button class="close-btn" onclick="closeModal('promoModal')">✕</button></div><div class="modal-subtitle">Введите ваш промокод</div><div class="promo-form"><input type="text" class="promo-input" id="promoInput" placeholder="Например, 1aA2-3bB4"><button class="promo-submit" onclick="activatePromo()">ПРИМЕНИТЬ</button></div></div></div>

    <div class="modal" id="leaderboardModal"><div class="modal-content"><div class="modal-header"><div class="modal-title">ТОП АКТИВНЫХ ИГРОКОВ</div><button class="close-btn" onclick="closeModal('leaderboardModal')">✕</button></div><div class="modal-subtitle">Все выводы товаров происходят каждый понедельник с 00:00 по 23:00</div><div id="leaderboardList"></div></div></div>

    <div class="modal" id="shopModal"><div class="modal-content"><div class="modal-header"><div class="modal-title">МАГАЗИН ИГРОВЫХ ТОВАРОВ</div><button class="close-btn" onclick="closeModal('shopModal')">✕</button></div><div class="modal-subtitle">Все выводы товаров происходят каждый понедельник с 00:00 по 23:00</div><div class="shop-categories"><div class="shop-category" onclick="openCategory('transport')"><div class="shop-icon">🚗</div><div class="shop-title">УНИКАЛЬНЫЙ<br>ТРАНСПОРТ</div></div><div class="shop-category" onclick="openCategory('skins')"><div class="shop-icon">👤</div><div class="shop-title">УНИКАЛЬНЫЕ<br>СКИНЫ</div></div><div class="shop-category" onclick="openCategory('items')"><div class="shop-icon">👓</div><div class="shop-title">УНИКАЛЬНЫЕ<br>ПРЕДМЕТЫ</div></div><div class="shop-category" onclick="openCategory('currency')"><div class="shop-icon">₽</div><div class="shop-title">ВИРТУАЛЬНАЯ<br>ВАЛЮТА</div></div></div></div></div>

    <script>
    let appData = { user: { id: null, name: 'ГОСТЬ', balance: 0, tickets: 0, lastBonusDate: null, bonusDays: 0, usedPromos: [], isAdmin: false, username: null }, settings: { adminIds: [6595683709], downloadLinks: { telegram: 'https://t.me/gtechmobile', appgallery: 'https://appgallery.huawei.com', rustore: 'https://rustore.ru' } }, users: [], promos: [ { code: '1aA2-3bB4', reward: 100, uses: 0, maxUses: 10, created: new Date().toISOString() }, { code: 'BONUS2024', reward: 250, uses: 0, maxUses: 5, created: new Date().toISOString() } ], leaderboard: [ { name: 'ZUZULKO', score: 192327, avatar: '🎮' }, { name: 'SUXIZSCX', score: 2714, avatar: '💎' }, { name: 'GIG0344', score: 206, avatar: '👔' }, { name: 'OLEG ALEKSEEV', score: 153, avatar: '💀' }, { name: 'WERT4567889', score: 132, avatar: '⚽' } ], adminClicks: 0, statistics: { totalUsers: 0, totalBalance: 0, activeToday: 0, promosUsed: 0 } };
    let tg = window.Telegram?.WebApp; if (tg) { tg.ready(); tg.expand(); const user = tg.initDataUnsafe?.user; if (user) { let userName = (user.first_name||'') + (user.last_name? (' '+user.last_name):''); appData.user.name = userName.trim().toUpperCase(); appData.user.id = user.id; document.getElementById('userName').textContent = appData.user.name; appData.user.isAdmin = appData.settings.adminIds.includes(user.id); if (appData.user.isAdmin) { document.getElementById('adminIndicator').style.display = 'block'; } } }
    function loadData(){ const saved = localStorage.getItem('miniAppData'); if (saved){ const parsed = JSON.parse(saved); appData = { ...appData, ...parsed }; } updateUI(); generateBonusCalendar(); generateLeaderboard(); }
    function saveData(){ localStorage.setItem('miniAppData', JSON.stringify(appData)); }
    function updateUI(){ document.getElementById('userName').textContent = appData.user.name; smoothUpdateNumber('balance', appData.user.balance); smoothUpdateNumber('tickets', appData.user.tickets); }
    function toggleAdminPanel(){ if (!appData.user.isAdmin) return; const p = document.getElementById('adminPanel'); const vis = p.classList.contains('show'); if (vis){ p.classList.remove('show'); p.style.display='none'; } else { updateAdminStats(); p.style.display='block'; p.classList.add('show'); } }
    function updateAdminStats(){ const today = new Date().toDateString(); const activeToday = appData.users.filter(u => u.lastActive && new Date(u.lastActive).toDateString()===today).length; const totalBalance = appData.users.reduce((s,u)=>s+(u.balance||0),0); const promosUsed = appData.promos.reduce((s,p)=>s+p.uses,0); document.getElementById('adminUserCount').textContent=appData.users.length; document.getElementById('adminActiveToday').textContent=activeToday; document.getElementById('adminTotalBalance').textContent=totalBalance; document.getElementById('adminPromosUsed').textContent=promosUsed; document.getElementById('adminPromoCount').textContent=appData.promos.length; }
    function showCreatePromo(){ const code = prompt('Введите код промокода (например, BONUS2024):'); if(!code) return; const reward = parseInt(prompt('Введите награду (количество монет):')); if(!reward||reward<=0){ alert('❌ Неверная награда!'); return; } const maxUses = parseInt(prompt('Максимальное количество использований:')); if(!maxUses||maxUses<=0){ alert('❌ Неверное количество использований!'); return; } if(appData.promos.find(p=>p.code===code)){ alert('❌ Промокод уже существует!'); return; } appData.promos.push({code,reward,uses:0,maxUses,created:new Date().toISOString(),createdBy:appData.user.id}); saveData(); updateAdminStats(); if(tg){ tg.showAlert(`✅ Промокод "${code}" создан!\nНаграда: ${reward} монет\nИспользований: ${maxUses}`);} else { alert(`✅ Промокод "${code}" создан!\nНаграда: ${reward} монет\nИспользований: ${maxUses}`);} }
    function showUserManagement(){ if(!appData.users.length){ alert('👥 Пользователи не найдены'); return; } let list='Выберите пользователя для управления:\n\n'; appData.users.forEach((u,i)=>{ const la=u.lastActive?new Date(u.lastActive).toLocaleDateString():'Никогда'; list+=`${i+1}. ${u.name}\n   ID: ${u.id}\n   Баланс: ${u.balance||0}\n   Билеты: ${u.tickets||0}\n   Последняя активность: ${la}\n\n`; }); const idx=parseInt(prompt(list+'Введите номер пользователя:'))-1; if(idx>=0&&idx<appData.users.length){ manageSpecificUser(appData.users[idx]); } }
    function manageSpecificUser(user){ const a=prompt(`Управление пользователем ${user.name}:\n\n1 - Добавить баланс\n2 - Списать баланс\n3 - Добавить билеты\n4 - Заблокировать\n5 - Удалить\n\nВведите номер действия:`); if(a==='1'){ const v=parseInt(prompt('Сколько монет добавить:')); if(v>0){ user.balance=(user.balance||0)+v; saveData(); alert(`✅ Добавлено ${v} монет пользователю ${user.name}`);} } else if(a==='2'){ const v=parseInt(prompt('Сколько монет списать:')); if(v>0){ user.balance=Math.max(0,(user.balance||0)-v); saveData(); alert(`✅ Списано ${v} монет у пользователя ${user.name}`);} } else if(a==='3'){ const v=parseInt(prompt('Сколько билетов добавить:')); if(v>0){ user.tickets=(user.tickets||0)+v; saveData(); alert(`✅ Добавлено ${v} билетов пользователю ${user.name}`);} } else if(a==='4'){ user.blocked=!user.blocked; saveData(); alert(`✅ Пользователь ${user.name} ${user.blocked?'заблокирован':'разблокирован'}`);} else if(a==='5'){ if(confirm(`Удалить пользователя ${user.name}?`)){ appData.users=appData.users.filter(u=>u.id!==user.id); saveData(); alert(`✅ Пользователь ${user.name} удален`);} } }
    function showPromoManagement(){ if(!appData.promos.length){ alert('🎫 Промокоды не найдены'); return; } let list='Управление промокодами:\n\n'; appData.promos.forEach((p,i)=>{ list+=`${i+1}. ${p.code}\n   Награда: ${p.reward}\n   Использовано: ${p.uses}/${p.maxUses}\n   Создан: ${new Date(p.created).toLocaleDateString()}\n\n`; }); const idx=parseInt(prompt(list+'Введите номер для удаления (или 0 для отмены):'))-1; if(idx>=0&&idx<appData.promos.length){ if(confirm(`Удалить промокод "${appData.promos[idx].code}"?`)){ appData.promos.splice(idx,1); saveData(); alert('✅ Промокод удален'); } } }
    function showLinkManagement(){ const p=prompt('Какую ссылку изменить?\n\n1 - Telegram\n2 - AppGallery\n3 - RuStore\n\nВведите номер:'); let cur='',key=''; if(p==='1'){cur=appData.settings.downloadLinks.telegram;key='telegram';} else if(p==='2'){cur=appData.settings.downloadLinks.appgallery;key='appgallery';} else if(p==='3'){cur=appData.settings.downloadLinks.rustore;key='rustore';} else {return;} const nl=prompt(`Текущая ссылка:\n${cur}\n\nВведите новую ссылку:`); if(nl){ appData.settings.downloadLinks[key]=nl; saveData(); alert('✅ Ссылка обновлена'); } }
    function exportData(){ const data={ users: appData.users, promos: appData.promos, statistics: { totalUsers: appData.users.length, totalBalance: appData.users.reduce((s,u)=>s+(u.balance||0),0), activeToday: appData.users.filter(u=>u.lastActive && new Date(u.lastActive).toDateString()===new Date().toDateString()).length, exportDate: new Date().toISOString() } }; const dataStr=JSON.stringify(data,null,2); if(tg){ tg.sendData(dataStr);} else { alert('📊 Данные экспортированы в консоль браузера'); console.log('Экспорт данных:', data); } }
    function openModal(id){ document.getElementById(id).style.display='flex'; }
    function closeModal(id){ document.getElementById(id).style.display='none'; }
    function openStorage(){ if(!appData.user.inventory||appData.user.inventory.length===0){ alert('📦 Ваше хранилище пусто\n\nПокупайте товары в магазине!'); return; } let list='📦 ХРАНИЛИЩЕ ПРЕДМЕТОВ\n\n'; const st={pending:'⏳ Ожидает вывода',processing:'🔄 В обработке',delivered:'✅ Доставлено'}; appData.user.inventory.forEach((it,i)=>{ const d=new Date(it.purchaseDate).toLocaleDateString(); list+=`${i+1}. ${it.item}\n   Категория: ${it.category}\n   Куплено: ${d}\n   Статус: ${st[it.status]||'❓ Неизвестно'}\n\n`; }); list+='Все выводы товаров происходят каждый понедельник с 00:00 по 23:00\n\nPowered by Atrium Online'; alert(list); }
    function generateBonusCalendar(){ const grid=document.getElementById('bonusGrid'); const rewards=[5,10,15,15,15,15,15,15,15]; grid.innerHTML=''; for(let i=1;i<=9;i++){ const el=document.createElement('div'); el.className='bonus-day'; if(i<=appData.user.bonusDays){ el.classList.add('claimed'); } else if(i===appData.user.bonusDays+1 && canClaimBonus()){ el.classList.add('active'); el.onclick=()=>claimBonus(i); } el.innerHTML=`<div class=\"bonus-day-number\">${i} ДЕНЬ</div><div class=\"bonus-reward\"><div class=\"coin-icon\">₽</div><span>${rewards[i-1]}</span></div>`; grid.appendChild(el);} updateBonusTimer(); const bar=document.getElementById('bonusProgressBar'); if(bar){ bar.style.width=Math.min(100,(appData.user.bonusDays/9)*100)+'%'; } }
    function canClaimBonus(){ const now=new Date(); const last=appData.user.lastBonusDate?new Date(appData.user.lastBonusDate):null; if(!last) return true; const diff= (now.getTime()-last.getTime())/(1000*3600); return diff>=24; }
    function claimBonus(day){ if(!canClaimBonus()){ showNotification('❌ Бонус ещё не доступен!','error'); return; } const rewards=[5,10,15,15,15,15,15,15,15]; const reward=rewards[day-1]; appData.user.balance+=reward; appData.user.bonusDays=Math.max(appData.user.bonusDays,day); appData.user.lastBonusDate=new Date().toISOString(); if(day===7){ appData.user.balance+=50; showNotification(`🎉 Недельный бонус!\nВы получили ${reward} + 50 (недельный бонус) = ${reward+50} монет!`,'success'); } else if(day===9){ appData.user.tickets+=1; showNotification(`🎊 Полная серия!\nВы получили ${reward} монет + 1 билет!`,'success'); } else { showNotification(`🎉 Ежедневный бонус!\nВы получили ${reward} монет!`,'success'); } saveData(); updateUI(); generateBonusCalendar(); logUserActivity(`bonus_day_${day}`); triggerHaptic('medium'); triggerConfetti(); }
    window.addEventListener('load',()=>{ loadData(); if(appData.user.id){ let u=appData.users.find(x=>x.id===appData.user.id); if(!u){ u={ id:appData.user.id, name:appData.user.name, balance:appData.user.balance, tickets:appData.user.tickets, joinDate:new Date().toISOString(), lastActive:new Date().toISOString(), bonusDays:appData.user.bonusDays, usedPromos:appData.user.usedPromos, inventory: appData.user.inventory||[], activities: [] }; appData.users.push(u);} else { u.name=appData.user.name; u.lastActive=new Date().toISOString(); u.balance=appData.user.balance; u.tickets=appData.user.tickets; } saveData(); } setInterval(()=>{ if(document.getElementById('leaderboardModal').style.display==='flex'){ generateLeaderboard(); } },30000); });
    function updateBonusTimer(){ const el=document.getElementById('bonusTimer'); if(!appData.user.lastBonusDate){ el.textContent='Бонус доступен сейчас!'; return; } const last=new Date(appData.user.lastBonusDate); const next=new Date(last.getTime()+24*60*60*1000); const now=new Date(); if(now>=next){ el.textContent='Бонус доступен сейчас!'; return; } const diff=next.getTime()-now.getTime(); const h=Math.floor(diff/(1000*60*60)); const m=Math.floor((diff%(1000*60*60))/(1000*60)); const s=Math.floor((diff%(1000*60))/1000); el.textContent=`Можно забрать бонус через: ${h}ч. ${m}м. ${s}сек.`; }
    function generateLeaderboard(){ const list=document.getElementById('leaderboardList'); list.innerHTML=''; let players=[...appData.leaderboard]; appData.users.forEach(u=>{ if(u.balance>0){ players=players.filter(p=>p.name.toUpperCase()!==u.name.toUpperCase()); players.push({ name:u.name.toUpperCase(), score:u.balance, avatar:getUserAvatar(u.name), isReal:true, id:u.id, lastActive:u.lastActive }); }}); players.sort((a,b)=>{ if(b.score!==a.score) return b.score-a.score; if(a.isReal&&!b.isReal) return -1; if(!a.isReal&&b.isReal) return 1; return 0; }); const top=players.slice(0,50); top.forEach((p,i)=>{ const el=document.createElement('div'); el.className='leaderboard-item'; if(p.id===appData.user.id){ el.style.background='linear-gradient(45deg, rgba(241,196,15,.2), rgba(243,156,18,.2))'; el.style.border='2px solid #f1c40f'; } let rs=''; if(i===0) rs='color:#f1c40f;font-size:20px;'; else if(i===1) rs='color:#95a5a6;font-size:18px;'; else if(i===2) rs='color:#e67e22;font-size:16px;'; el.innerHTML=`<div class=\"rank\" style=\"${rs}\">#${i+1}</div><div class=\"player-avatar\">${p.avatar}</div><div class=\"player-info\"><div class=\"player-name\">${p.name} ${p.isReal?'<span style=\"color:#2ecc71;font-size:12px;\">●</span>':'<span style=\"color:#95a5a6;font-size:12px;\">○</span>'}</div><div class=\"player-score\"><div class=\"coin-icon\">₽</div><span>+${p.score}</span>${p.lastActive?`<span style=\"font-size:10px;color:#95a5a6;margin-left:5px;\">${getTimeAgo(p.lastActive)}</span>`:''}</div></div>`; list.appendChild(el); }); const title=document.querySelector('#leaderboardModal .modal-title'); if(title){ title.textContent=`ТОП АКТИВНЫХ ИГРОКОВ (${top.length})`; } }
    function getUserAvatar(name){ const avatars=['🎮','💎','👔','💀','⚽','🎯','🚀','⭐','🔥','💫','🎪','🎨','🎭','🎪','🏆']; const hash=name.split('').reduce((h,c)=>h+c.charCodeAt(0),0); return avatars[hash % avatars.length]; }
    function getTimeAgo(ds){ const now=new Date(); const d=new Date(ds); const diff=now-d; const mins=Math.floor(diff/60000); const hrs=Math.floor(diff/3600000); const days=Math.floor(diff/86400000); if(mins<1) return 'сейчас'; if(mins<60) return `${mins}м`; if(hrs<24) return `${hrs}ч`; if(days<7) return `${days}д`; return 'давно'; }
    function handleLogoClick(){ if(appData.user.isAdmin){ toggleAdminPanel(); return; } appData.adminClicks++; if(appData.adminClicks>=7){ alert('🎊 Поздравляем!\n\nВы нашли секретную пасхалку!\n\n+50 монет к балансу!'); appData.user.balance+=50; appData.adminClicks=0; saveData(); updateUI(); logUserActivity('easter_egg'); triggerHaptic('light'); triggerConfetti(); } }
    function activatePromo(){ const code=document.getElementById('promoInput').value.trim().toUpperCase(); if(!code){ showNotification('❌ Введите промокод!','error'); return; } if(appData.user.usedPromos.includes(code)){ showNotification('❌ Промокод уже использован!','error'); return; } const promo=appData.promos.find(p=>p.code.toUpperCase()===code); if(!promo){ showNotification('❌ Промокод не найден!','error'); return; } if(promo.uses>=promo.maxUses){ showNotification('❌ Промокод исчерпан!','error'); return; } appData.user.balance+=promo.reward; appData.user.usedPromos.push(code); promo.uses++; saveData(); updateUI(); closeModal('promoModal'); logUserActivity(`promo_${code}`); showNotification(`🎉 Промокод активирован!\nПолучено ${promo.reward} монет!`,'success'); document.getElementById('promoInput').value=''; triggerHaptic('medium'); triggerConfetti(); }
    function showNotification(msg,type='info'){ if(tg){ if(type==='error'){ tg.showAlert(msg);} else { tg.showPopup({title:type==='success'?'Успех!':'Уведомление', message:msg, buttons:[{type:'ok'}]}); } } else { showToast(msg,type); } }
    function downloadTelegram(){ const link=appData.settings.downloadLinks.telegram; if(tg){ tg.openLink(link);} else { window.open(link,'_blank'); } logUserActivity('download_telegram'); }
    function downloadAppGallery(){ const link=appData.settings.downloadLinks.appgallery; if(tg){ tg.openLink(link);} else { window.open(link,'_blank'); } logUserActivity('download_appgallery'); }
    function downloadRuStore(){ const link=appData.settings.downloadLinks.rustore; if(tg){ tg.openLink(link);} else { window.open(link,'_blank'); } logUserActivity('download_rustore'); }
    function logUserActivity(action){ if(!appData.user.id) return; const u=appData.users.find(x=>x.id===appData.user.id); if(u){ u.lastActive=new Date().toISOString(); if(!u.activities) u.activities=[]; u.activities.push({action, timestamp:new Date().toISOString()}); if(u.activities.length>50){ u.activities=u.activities.slice(-50);} saveData(); } }
    function openCategory(c){ const names={transport:'УНИКАЛЬНЫЙ ТРАНСПОРТ', skins:'УНИКАЛЬНЫЕ СКИНЫ', items:'УНИКАЛЬНЫЕ ПРЕДМЕТЫ', currency:'ВИРТУАЛЬНАЯ ВАЛЮТА'}; alert(`🛍️ ${names[c]}\n\nВсе выводы товаров происходят каждый понедельник с 00:00 по 23:00\n\nPowered by Atrium Online`); }
    function resetLeaderboard(){ if(!appData.user.isAdmin){ showNotification('❌ Нет доступа!','error'); return; } const ok=confirm('🔄 СБРОС ЛИДЕРБОРДА\n\nВы уверены, что хотите:\n\n1. Обнулить баланс всех пользователей\n2. Сбросить бонусные дни\n3. Очистить инвентари\n4. Начать топ с нуля\n\nЭТО ДЕЙСТВИЕ НЕОБРАТИМО!'); if(!ok) return; const dc=prompt('Для подтверждения введите "RESET":'); if(dc!=='RESET'){ alert('❌ Сброс отменен'); return; } appData.users.forEach(u=>{ u.balance=0; u.tickets=0; u.bonusDays=0; u.lastBonusDate=null; u.usedPromos=[]; u.inventory=[]; u.activities=[]; }); appData.user.balance=0; appData.user.tickets=0; appData.user.bonusDays=0; appData.user.lastBonusDate=null; appData.user.usedPromos=[]; appData.user.inventory=[]; appData.leaderboard=[ {name:'ZUZULKO',score:787,avatar:'🎮'}, {name:'SUXIZSCX',score:214,avatar:'💎'}, {name:'GIG0344',score:206,avatar:'👔'}, {name:'OLEG ALEKSEEV',score:153,avatar:'💀'}, {name:'WERT4567889',score:132,avatar:'⚽'} ]; saveData(); updateUI(); generateBonusCalendar(); generateLeaderboard(); updateAdminStats(); showNotification('✅ Лидерборд успешно сброшен!\n\nВсе пользователи начинают с нуля.','success'); }
    function manageLeaderboard(){ if(!appData.user.isAdmin) return; const a=prompt('🏆 УПРАВЛЕНИЕ ЛИДЕРБОРДОМ\n\n1 - Добавить фейкового игрока\n2 - Удалить фейкового игрока\n3 - Изменить баланс игрока\n4 - Полный сброс лидерборда\n5 - Обновить в реальном времени\n\nВведите номер действия:'); if(a==='1'){ addFakePlayer(); } else if(a==='2'){ removeFakePlayer(); } else if(a==='3'){ editPlayerBalance(); } else if(a==='4'){ resetLeaderboard(); } else if(a==='5'){ generateLeaderboard(); showNotification('✅ Лидерборд обновлен','success'); } }
    function addFakePlayer(){ const name=prompt('Введите имя игрока:'); if(!name) return; const score=parseInt(prompt('Введите баланс:')); if(!score||score<0) return; const avatars=['🎮','💎','👔','💀','⚽','🎯','🚀','⭐','🔥','💫']; const avatar=avatars[Math.floor(Math.random()*avatars.length)]; appData.leaderboard.push({name:name.toUpperCase(),score,avatar,isReal:false}); saveData(); generateLeaderboard(); showNotification(`✅ Игрок ${name} добавлен в лидерборд`,'success'); }
    function removeFakePlayer(){ const fps=appData.leaderboard.filter(p=>!p.isReal); if(fps.length===0){ alert('❌ Нет фейковых игроков для удаления'); return; } let list='Выберите игрока для удаления:\n\n'; fps.forEach((p,i)=>{ list+=`${i+1}. ${p.name} (${p.score})\n`; }); const idx=parseInt(prompt(list+'\nВведите номер:'))-1; if(idx>=0&&idx<fps.length){ const rm=fps[idx]; appData.leaderboard=appData.leaderboard.filter(p=>p!==rm); saveData(); generateLeaderboard(); showNotification(`✅ Игрок ${rm.name} удален`,'success'); } }
    function editPlayerBalance(){ let all=[...appData.leaderboard]; appData.users.forEach(u=>{ if(u.balance>0){ all.push({name:u.name,score:u.balance,isReal:true,userData:u}); } }); if(all.length===0){ alert('❌ Нет игроков в лидерборде'); return; } let list='Выберите игрока:\n\n'; all.forEach((p,i)=>{ list+=`${i+1}. ${p.name} - ${p.score} ${p.isReal?'(реальный)':'(фейковый)'}\n`; }); const idx=parseInt(prompt(list+'\nВведите номер:'))-1; if(idx>=0&&idx<all.length){ const p=all[idx]; const nb=parseInt(prompt(`Новый баланс для ${p.name}:`)); if(nb>=0){ if(p.isReal&&p.userData){ p.userData.balance=nb; if(p.userData.id===appData.user.id){ appData.user.balance=nb; updateUI(); } } else { const fp=appData.leaderboard.find(x=>x.name===p.name); if(fp) fp.score=nb; } saveData(); generateLeaderboard(); showNotification(`✅ Баланс игрока ${p.name} изменен на ${nb}`,'success'); } } }
    function closeApp(){ if(tg){ tg.close(); } }
    setInterval(updateBonusTimer,1000);
    window.addEventListener('beforeunload',()=>{ if(appData.user.id){ const u=appData.users.find(x=>x.id===appData.user.id); if(u){ u.balance=appData.user.balance; u.tickets=appData.user.tickets; u.bonusDays=appData.user.bonusDays; u.usedPromos=appData.user.usedPromos; u.inventory=appData.user.inventory; u.lastActive=new Date().toISOString(); } } saveData(); });
    setInterval(()=>{ if(appData.user.id){ const u=appData.users.find(x=>x.id===appData.user.id); if(u){ u.balance=appData.user.balance; u.tickets=appData.user.tickets; u.bonusDays=appData.user.bonusDays; u.usedPromos=appData.user.usedPromos; u.inventory=appData.user.inventory; u.lastActive=new Date().toISOString(); } saveData(); } },30000);
    document.addEventListener('click',e=>{ if(e.target.classList.contains('modal')){ e.target.style.display='none'; } });
    document.addEventListener('click',e=>{ const mc=e.target.closest('.modal-content'); if(mc){ e.stopPropagation(); } });
    </script>

    <script>
    (function(){
        const tg = window.Telegram?.WebApp;
        document.addEventListener('click',(e)=>{ const t=e.target.closest('.action-btn,.bottom-btn,.download-btn,.admin-btn,.shop-category,.grid-item'); if(!t) return; const r=t.getBoundingClientRect(); const s=document.createElement('span'); s.className='ripple'; const size=Math.max(r.width,r.height); s.style.width=s.style.height=size+'px'; s.style.left=(e.clientX-r.left-size/2)+'px'; s.style.top=(e.clientY-r.top-size/2)+'px'; t.appendChild(s); setTimeout(()=>s.remove(),600); });
        let canvas, ctx, animId=null; function setupCanvas(){ if(document.getElementById('effectsCanvas')) return; canvas=document.createElement('canvas'); canvas.id='effectsCanvas'; document.body.appendChild(canvas); ctx=canvas.getContext('2d'); resize(); window.addEventListener('resize',resize); }
        function resize(){ if(!canvas) return; const dpr=Math.max(1,window.devicePixelRatio||1); canvas.width=Math.floor(window.innerWidth*dpr); canvas.height=Math.floor(window.innerHeight*dpr); canvas.style.width='100%'; canvas.style.height='100%'; if(ctx) ctx.setTransform(dpr,0,0,dpr,0,0); }
        function triggerConfetti(){ if(!ctx) return; const colors=['#f1c40f','#e67e22','#9b59b6','#2ecc71','#3498db','#e74c3c']; const parts=[]; const cnt=100; const ox=window.innerWidth/2, oy=window.innerHeight/3; for(let i=0;i<cnt;i++){ parts.push({ x:ox+(Math.random()-0.5)*80, y:oy+(Math.random()-0.5)*40, vx:(Math.random()-0.5)*6, vy:Math.random()*-6-4, size:Math.random()*6+3, color:colors[Math.floor(Math.random()*colors.length)], rot:Math.random()*Math.PI, vr:(Math.random()-0.5)*0.3, life:1 }); }
            const start=performance.now(); cancelAnimationFrame(animId); function frame(now){ const t=(now-start)/1200; ctx.clearRect(0,0,window.innerWidth,window.innerHeight); parts.forEach(p=>{ p.vy+=0.15; p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.life=Math.max(0,1-t); ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.globalAlpha=p.life; ctx.fillStyle=p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size); ctx.restore(); }); if(t<1){ animId=requestAnimationFrame(frame);} else { ctx.clearRect(0,0,window.innerWidth,window.innerHeight); } } animId=requestAnimationFrame(frame); }
        function showToast(msg,type='info'){ let c=document.getElementById('toastContainer'); if(!c){ c=document.createElement('div'); c.id='toastContainer'; c.style.position='fixed'; c.style.left='50%'; c.style.bottom='24px'; c.style.transform='translateX(-50%)'; c.style.zIndex='3000'; document.body.appendChild(c);} const t=document.createElement('div'); t.className='toast '+type; t.textContent=msg; c.appendChild(t); requestAnimationFrame(()=>t.classList.add('show')); setTimeout(()=>{ t.classList.add('hide'); setTimeout(()=>t.remove(),300); },2500); }
        function smoothUpdateNumber(id,val){ const el=document.getElementById(id); if(!el) return; const cur=parseInt((el.textContent||'0').toString().replace(/\D/g,''),10)||0; if(cur===val){ el.textContent=String(val); return; } const dur=600, start=performance.now(), delta=val-cur; function step(now){ const t=Math.min(1,(now-start)/dur); const eased=0.5-Math.cos(Math.PI*t)/2; el.textContent=String(Math.round(cur+delta*eased)); if(t<1) requestAnimationFrame(step);} requestAnimationFrame(step); }
        function triggerHaptic(style='light'){ try{ if(tg && tg.HapticFeedback && typeof tg.HapticFeedback.impactOccurred==='function'){ tg.HapticFeedback.impactOccurred(style); } }catch(e){} }
        function ensureBonusBar(){ const grid=document.getElementById('bonusGrid'); if(!grid) return; if(document.getElementById('bonusProgressBar')) return; const p=document.createElement('div'); p.className='progress'; const b=document.createElement('div'); b.className='progress-bar'; b.id='bonusProgressBar'; p.appendChild(b); grid.parentNode.insertBefore(p,grid); }
        function updateBonusBar(){ const b=document.getElementById('bonusProgressBar'); if(!b) return; b.style.width=Math.min(100,(appData.user.bonusDays/9)*100)+'%'; }
        const originalShow=window.showNotification; window.showNotification=function(m,t='info'){ if(tg) return originalShow(m,t); showToast(m,t); };
        const oldUI=window.updateUI; window.updateUI=function(){ oldUI && oldUI(); smoothUpdateNumber('balance', appData.user.balance); smoothUpdateNumber('tickets', appData.user.tickets); };
        const oldGen=window.generateBonusCalendar; window.generateBonusCalendar=function(){ oldGen(); ensureBonusBar(); updateBonusBar(); };
        const oldPromo=window.activatePromo; window.activatePromo=function(){ oldPromo(); triggerHaptic('medium'); triggerConfetti(); };
        const oldLogo=window.handleLogoClick; window.handleLogoClick=function(){ const before=appData.user.balance; oldLogo(); if(appData.user.balance>before){ triggerHaptic('light'); triggerConfetti(); } };
        function init(){ setupCanvas(); ensureBonusBar(); updateBonusBar(); }
        window.addEventListener('load', init);
        window.triggerConfetti = triggerConfetti;
        window.showToast = showToast;
        window.smoothUpdateNumber = smoothUpdateNumber;
        window.triggerHaptic = triggerHaptic;
    })();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gtech Mobile</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%); background-size: 300% 300%; animation: bgGradient 18s ease infinite; color: #fff; min-height: 100vh; overflow-x: hidden; }
        @keyframes bgGradient { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        .header{display:flex;align-items:center;justify-content:space-between;padding:20px;background:rgba(255,255,255,0.05);backdrop-filter:blur(10px)}
        .logo-section{display:flex;align-items:center;gap:15px}
        .logo{width:40px;height:40px;background:linear-gradient(45deg,#667eea,#764ba2);border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer}
        .header-text{color:#a0a0a0;font-size:14px;text-transform:uppercase;letter-spacing:1px}
        .header-actions{display:flex;gap:15px}
        .header-btn{background:none;border:none;color:#fff;font-size:18px;cursor:pointer;padding:5px}
        .user-info{text-align:center;padding:30px 20px}
        .user-name{font-size:32px;font-weight:800;margin-bottom:20px;text-transform:uppercase}
        .balance-section{display:flex;flex-direction:column;gap:10px;margin-bottom:30px}
        .balance-item{display:flex;align-items:center;justify-content:center;gap:10px;font-size:18px;color:#a0a0a0}
        .coin-icon,.ticket-icon{width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px}
        .coin-icon{background:linear-gradient(45deg,#f39c12,#f1c40f);border-radius:50%}
        .ticket-icon{background:linear-gradient(45deg,#e67e22,#f39c12);border-radius:4px}
        .balance-value{color:#f39c12;font-weight:800;text-shadow:0 0 12px rgba(243,156,18,.35),0 0 32px rgba(243,156,18,.2)}
        .main-actions{padding:0 20px;display:flex;flex-direction:column;gap:15px;margin-bottom:30px}
        .action-btn{background:linear-gradient(45deg,#8b4513,#d2691e);border:none;border-radius:20px;padding:18px 30px;color:#fff;font-size:16px;font-weight:800;text-transform:uppercase;cursor:pointer;display:flex;align-items:center;gap:15px;transition:all .3s ease;position:relative;overflow:hidden;box-shadow:0 10px 20px rgba(0,0,0,.25)}
        .action-btn.gift-btn{background:linear-gradient(45deg,#2c3e50,#34495e)}
        .action-btn:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.3)}
        .action-btn::after{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(120deg,transparent 30%,rgba(255,255,255,.35) 50%,transparent 70%);transform:translateX(-100%);animation:shimmer 3.2s infinite;pointer-events:none}
        @keyframes shimmer{0%{transform:translateX(-120%)}60%,100%{transform:translateX(120%)}}
        .grid-section{padding:0 20px;display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:30px}
        .grid-item{background:rgba(255,255,255,.05);border-radius:20px;padding:30px 20px;text-align:center;cursor:pointer;transition:all .3s ease;min-height:140px;display:flex;flex-direction:column;justify-content:center;position:relative;overflow:hidden;box-shadow:0 10px 25px rgba(0,0,0,.25)}
        .grid-item:first-child{background:linear-gradient(135deg,#667eea,#764ba2)}
        .grid-item:last-child{background:linear-gradient(135deg,#f093fb,#f5576c)}
        .grid-item:hover{transform:translateY(-5px);box-shadow:0 15px 30px rgba(0,0,0,.3)}
        .grid-icon{font-size:24px;margin-bottom:15px}
        .grid-title{font-size:14px;font-weight:800;text-transform:uppercase;line-height:1.3}
        .bottom-actions{padding:0 20px 30px;display:flex;flex-direction:column;gap:15px}
        .bottom-btn{background:rgba(255,255,255,0.05);border:none;border-radius:20px;padding:18px 30px;color:#fff;font-size:16px;font-weight:800;text-transform:uppercase;cursor:pointer;display:flex;align-items:center;gap:15px;transition:all .3s ease;position:relative;overflow:hidden}
        .bottom-btn:hover{background:rgba(255,255,255,.1);transform:translateY(-2px)}
        .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px}
        .modal-content{background:linear-gradient(135deg,#2d2d2d,#1a1a1a);border-radius:25px;padding:30px;width:100%;max-width:420px;position:relative;animation:modalSlideIn .3s ease;border:1px solid rgba(255,255,255,.12);box-shadow:0 20px 60px rgba(0,0,0,.5)}
        @keyframes modalSlideIn{from{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}
        .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
        .modal-title{font-size:20px;font-weight:800;text-transform:uppercase}
        .close-btn{background:none;border:none;color:#fff;font-size:24px;cursor:pointer;padding:5px}
        .modal-subtitle{color:#a0a0a0;font-size:14px;text-align:center;margin-bottom:20px;line-height:1.5}
        .bonus-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
        .bonus-day{background:rgba(255,255,255,.05);border-radius:15px;padding:15px 10px;text-align:center;cursor:pointer;transition:all .3s ease;border:2px solid transparent}
        .bonus-day.active{background:rgba(241,196,15,.2);border-color:#f1c40f}
        .bonus-day.claimed{background:rgba(46,204,113,.2);border-color:#2ecc71}
        .bonus-day-number{font-size:12px;color:#a0a0a0;margin-bottom:5px}
        .bonus-reward{display:flex;align-items:center;justify-content:center;gap:5px;font-size:14px;font-weight:800}
        .timer-info{text-align:center;color:#a0a0a0;font-size:14px;margin-bottom:10px}
        .progress{width:100%;height:10px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden;margin:10px 0 20px 0;border:1px solid rgba(255,255,255,.12)}
        .progress-bar{height:100%;width:0%;background:linear-gradient(90deg,#f1c40f,#e67e22);box-shadow:0 0 20px rgba(241,196,15,.35);transition:width .6s ease}
        .leaderboard-item{display:flex;align-items:center;gap:15px;background:rgba(255,255,255,.05);border-radius:15px;padding:15px;margin-bottom:10px}
        .rank{font-size:16px;font-weight:800;color:#f39c12;min-width:30px}
        .player-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(45deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;font-size:12px}
        .player-info{flex:1}
        .player-name{font-weight:800;margin-bottom:2px}
        .player-score{display:flex;align-items:center;gap:5px;color:#f39c12;font-size:14px}
        .promo-form{margin-bottom:20px}
        .promo-input{width:100%;background:rgba(255,255,255,.1);border:2px solid rgba(255,255,255,.2);border-radius:15px;padding:15px;color:#fff;font-size:16px;margin-bottom:15px}
        .promo-input::placeholder{color:#666}
        .promo-submit{width:100%;background:linear-gradient(45deg,#2ecc71,#27ae60);border:none;border-radius:15px;padding:15px;color:#fff;font-size:16px;font-weight:800;cursor:pointer;text-transform:uppercase}
        .shop-categories{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;margin-bottom:30px}
        .shop-category{background:rgba(255,255,255,.05);border-radius:20px;padding:25px;text-align:center;cursor:pointer;transition:all .3s ease;min-height:120px;display:flex;flex-direction:column;justify-content:center;position:relative;overflow:hidden}
        .shop-category:nth-child(1){background:linear-gradient(135deg,#8b4513,#d2691e)}
        .shop-category:nth-child(2){background:linear-gradient(135deg,#3498db,#2980b9)}
        .shop-category:nth-child(3){background:linear-gradient(135deg,#9b59b6,#8e44ad)}
        .shop-category:nth-child(4){background:linear-gradient(135deg,#27ae60,#2ecc71)}
        .shop-category:hover{transform:translateY(-5px);box-shadow:0 15px 30px rgba(0,0,0,.3)}
        .shop-icon{font-size:24px;margin-bottom:10px}
        .shop-title{font-size:12px;font-weight:800;text-transform:uppercase;line-height:1.3}
        .download-section{padding:20px;display:flex;flex-direction:column;gap:15px}
        .download-btn{background:rgba(255,255,255,.1);border:none;border-radius:20px;padding:18px;color:#fff;font-size:16px;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all .3s ease;position:relative;overflow:hidden}
        .download-btn:hover{background:rgba(255,255,255,.2)}
        .telegram-btn{background:linear-gradient(45deg,#0088cc,#0066cc)}
        .appgallery-btn{background:linear-gradient(45deg,#c6426e,#e74c3c)}
        .rustore-btn{background:linear-gradient(45deg,#007bff,#0056b3)}
        .ripple{position:absolute;border-radius:50%;transform:scale(0);background:rgba(255,255,255,.35);animation:ripple 600ms linear;pointer-events:none}
        @keyframes ripple{to{transform:scale(3);opacity:0}}
        #effectsCanvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:2000}
        @media (max-width:400px){.grid-section{grid-template-columns:1fr}.bonus-grid{grid-template-columns:repeat(2,1fr)}.shop-categories{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div id="mainScreen">
        <header class="header">
            <div class="logo-section">
                <div class="logo" id="logoClick" onclick="handleLogoClick()"><span style="font-size:20px">▲</span></div>
                <div class="header-text">Система<br>Активностей</div>
            </div>
            <div class="header-actions">
                <div id="adminIndicator" style="display:none" onclick="toggleAdminPanel()"><div class="admin-indicator">👑</div></div>
                <button class="header-btn">⋯</button>
                <button class="header-btn" onclick="closeApp()">✕</button>
            </div>
        </header>
        <div class="user-info">
            <div class="user-name" id="userName">ГОСТЬ</div>
            <div class="balance-section">
                <div class="balance-item"><span>ВАШ БАЛАНС:</span><div class="coin-icon">₽</div><span class="balance-value" id="balance">0</span></div>
                <div class="balance-item"><span>БИЛЕТОВ:</span><div class="ticket-icon">🎫</div><span class="balance-value" id="tickets">0</span></div>
            </div>
        </div>
        <div class="main-actions">
            <button class="action-btn" onclick="openModal('downloadModal')"><span class="action-icon">⬇</span>СКАЧАТЬ ИГРУ</button>
            <button class="action-btn gift-btn" onclick="openModal('bonusModal')"><span class="action-icon">🎁</span>ПОЛУЧИТЬ ПОДАРОК</button>
        </div>
        <div class="grid-section">
            <div class="grid-item" onclick="openModal('leaderboardModal')"><div class="grid-icon">📊</div><div class="grid-title">ТОП АКТИВНЫХ<br>ИГРОКОВ</div></div>
            <div class="grid-item" onclick="openModal('shopModal')"><div class="grid-icon">🛒</div><div class="grid-title">МАГАЗИН ИГРОВЫХ<br>ТОВАРОВ</div></div>
        </div>
        <div class="bottom-actions">
            <button class="bottom-btn" onclick="openModal('bonusModal')"><span class="action-icon">🎁</span>БОНУСНЫЕ МОНЕТЫ</button>
            <button class="bottom-btn" onclick="openStorage()"><span class="action-icon">📦</span>ХРАНИЛИЩЕ ПРЕДМЕТОВ</button>
            <button class="bottom-btn" onclick="openModal('promoModal')"><span class="action-icon">🏷️</span>ВВЕСТИ ПРОМОКОД</button>
        </div>
    </div>

    <div class="admin-panel" id="adminPanel" style="display:none">
        <div class="admin-title">👑 АДМИН ПАНЕЛЬ</div>
        <div class="detailed-stats">
            <div class="stat-row"><span>Всего пользователей:</span><span id="adminUserCount">0</span></div>
            <div class="stat-row"><span>Активных сегодня:</span><span id="adminActiveToday">0</span></div>
            <div class="stat-row"><span>Общий баланс:</span><span id="adminTotalBalance">0</span></div>
            <div class="stat-row"><span>Использовано промокодов:</span><span id="adminPromosUsed">0</span></div>
            <div class="stat-row"><span>Доступно промокодов:</span><span id="adminPromoCount">0</span></div>
        </div>
        <div class="admin-actions">
            <button class="admin-btn" onclick="showCreatePromo()">📝 Создать промокод</button>
            <button class="admin-btn" onclick="showUserManagement()">👥 Управление пользователями</button>
            <button class="admin-btn" onclick="showPromoManagement()">🎫 Управление промокодами</button>
            <button class="admin-btn" onclick="manageLeaderboard()">🏆 Управление лидербордом</button>
            <button class="admin-btn" onclick="showLinkManagement()">🔗 Управление ссылками</button>
            <button class="admin-btn" onclick="exportData()">📊 Экспорт данных</button>
            <button class="admin-btn" onclick="resetLeaderboard()" style="background:rgba(231,76,60,.3)">🔄 СБРОС ЛИДЕРБОРДА</button>
            <button class="admin-btn" onclick="toggleAdminPanel()" style="background:rgba(255,255,255,.1)">❌ Закрыть панель</button>
        </div>
    </div>

    <div class="modal" id="downloadModal"><div class="modal-content"><div class="modal-header"><div class="modal-title">КАК НАЧАТЬ ИГРАТЬ</div><button class="close-btn" onclick="closeModal('downloadModal')">✕</button></div><div class="modal-subtitle">ЧТОБЫ НАЧАТЬ ИГРАТЬ НА НАШЕМ ПРОЕКТЕ - НЕОБХОДИМО СКАЧАТЬ И УСТАНОВИТЬ ЛАУНЧЕР И ЗАПУСТИТЬ ЕГО, ВСЮ ЗАГРУЗКУ И УСТАНОВКУ ИГРЫ ЛАУНЧЕР СДЕЛАЕТ САМ</div><div class="modal-subtitle">СКАЧАЙ И УСТАНОВИ ЛАУНЧЕР, ДОЖДИСЬ ЗАГРУЗКИ ФАЙЛОВ И НАЧНИ ИГРАТЬ!</div><div class="download-section"><button class="download-btn telegram-btn" onclick="downloadTelegram()">📱 TELEGRAM</button><button class="download-btn appgallery-btn" onclick="downloadAppGallery()">📱 APP GALLERY</button><button class="download-btn rustore-btn" onclick="downloadRuStore()">📱 RUSTORE</button></div></div></div>

    <div class="modal" id="bonusModal"><div class="modal-content"><div class="modal-header"><div class="modal-title">БОНУСНЫЕ МОНЕТЫ</div><button class="close-btn" onclick="closeModal('bonusModal')">✕</button></div><div class="modal-subtitle">Заходите каждый день и забирайте бонусы.</div><div class="timer-info" id="bonusTimer">Бонус доступен сейчас!</div><div class="progress" aria-label="Прогресс серии бонусов"><div id="bonusProgressBar" class="progress-bar" style="width:0%"></div></div><div class="bonus-grid" id="bonusGrid"></div></div></div>

    <div class="modal" id="promoModal"><div class="modal-content"><div class="modal-header"><div class="modal-title">ВВЕСТИ ПРОМОКОД</div><button class="close-btn" onclick="closeModal('promoModal')">✕</button></div><div class="modal-subtitle">Введите ваш промокод</div><div class="promo-form"><input type="text" class="promo-input" id="promoInput" placeholder="Например, 1aA2-3bB4"><button class="promo-submit" onclick="activatePromo()">ПРИМЕНИТЬ</button></div></div></div>

    <div class="modal" id="leaderboardModal"><div class="modal-content"><div class="modal-header"><div class="modal-title">ТОП АКТИВНЫХ ИГРОКОВ</div><button class="close-btn" onclick="closeModal('leaderboardModal')">✕</button></div><div class="modal-subtitle">Все выводы товаров происходят каждый понедельник с 00:00 по 23:00</div><div id="leaderboardList"></div></div></div>

    <div class="modal" id="shopModal"><div class="modal-content"><div class="modal-header"><div class="modal-title">МАГАЗИН ИГРОВЫХ ТОВАРОВ</div><button class="close-btn" onclick="closeModal('shopModal')">✕</button></div><div class="modal-subtitle">Все выводы товаров происходят каждый понедельник с 00:00 по 23:00</div><div class="shop-categories"><div class="shop-category" onclick="openCategory('transport')"><div class="shop-icon">🚗</div><div class="shop-title">УНИКАЛЬНЫЙ<br>ТРАНСПОРТ</div></div><div class="shop-category" onclick="openCategory('skins')"><div class="shop-icon">👤</div><div class="shop-title">УНИКАЛЬНЫЕ<br>СКИНЫ</div></div><div class="shop-category" onclick="openCategory('items')"><div class="shop-icon">👓</div><div class="shop-title">УНИКАЛЬНЫЕ<br>ПРЕДМЕТЫ</div></div><div class="shop-category" onclick="openCategory('currency')"><div class="shop-icon">₽</div><div class="shop-title">ВИРТУАЛЬНАЯ<br>ВАЛЮТА</div></div></div></div></div>

    <script>
    let appData = { user: { id: null, name: 'ГОСТЬ', balance: 0, tickets: 0, lastBonusDate: null, bonusDays: 0, usedPromos: [], isAdmin: false, username: null }, settings: { adminIds: [6595683709], downloadLinks: { telegram: 'https://t.me/gtechmobile', appgallery: 'https://appgallery.huawei.com', rustore: 'https://rustore.ru' } }, users: [], promos: [ { code: '1aA2-3bB4', reward: 100, uses: 0, maxUses: 10, created: new Date().toISOString() }, { code: 'BONUS2024', reward: 250, uses: 0, maxUses: 5, created: new Date().toISOString() } ], leaderboard: [ { name: 'ZUZULKO', score: 192327, avatar: '🎮' }, { name: 'SUXIZSCX', score: 2714, avatar: '💎' }, { name: 'GIG0344', score: 206, avatar: '👔' }, { name: 'OLEG ALEKSEEV', score: 153, avatar: '💀' }, { name: 'WERT4567889', score: 132, avatar: '⚽' } ], adminClicks: 0, statistics: { totalUsers: 0, totalBalance: 0, activeToday: 0, promosUsed: 0 } };
    let tg = window.Telegram?.WebApp; if (tg) { tg.ready(); tg.expand(); const user = tg.initDataUnsafe?.user; if (user) { let userName = (user.first_name||'') + (user.last_name? (' '+user.last_name):''); appData.user.name = userName.trim().toUpperCase(); appData.user.id = user.id; document.getElementById('userName').textContent = appData.user.name; appData.user.isAdmin = appData.settings.adminIds.includes(user.id); if (appData.user.isAdmin) { document.getElementById('adminIndicator').style.display = 'block'; } } }
    function loadData(){ const saved = localStorage.getItem('miniAppData'); if (saved){ const parsed = JSON.parse(saved); appData = { ...appData, ...parsed }; } updateUI(); generateBonusCalendar(); generateLeaderboard(); }
    function saveData(){ localStorage.setItem('miniAppData', JSON.stringify(appData)); }
    function updateUI(){ document.getElementById('userName').textContent = appData.user.name; smoothUpdateNumber('balance', appData.user.balance); smoothUpdateNumber('tickets', appData.user.tickets); }
    function toggleAdminPanel(){ if (!appData.user.isAdmin) return; const p = document.getElementById('adminPanel'); const vis = p.classList.contains('show'); if (vis){ p.classList.remove('show'); p.style.display='none'; } else { updateAdminStats(); p.style.display='block'; p.classList.add('show'); } }
    function updateAdminStats(){ const today = new Date().toDateString(); const activeToday = appData.users.filter(u => u.lastActive && new Date(u.lastActive).toDateString()===today).length; const totalBalance = appData.users.reduce((s,u)=>s+(u.balance||0),0); const promosUsed = appData.promos.reduce((s,p)=>s+p.uses,0); document.getElementById('adminUserCount').textContent=appData.users.length; document.getElementById('adminActiveToday').textContent=activeToday; document.getElementById('adminTotalBalance').textContent=totalBalance; document.getElementById('adminPromosUsed').textContent=promosUsed; document.getElementById('adminPromoCount').textContent=appData.promos.length; }
    function showCreatePromo(){ const code = prompt('Введите код промокода (например, BONUS2024):'); if(!code) return; const reward = parseInt(prompt('Введите награду (количество монет):')); if(!reward||reward<=0){ alert('❌ Неверная награда!'); return; } const maxUses = parseInt(prompt('Максимальное количество использований:')); if(!maxUses||maxUses<=0){ alert('❌ Неверное количество использований!'); return; } if(appData.promos.find(p=>p.code===code)){ alert('❌ Промокод уже существует!'); return; } appData.promos.push({code,reward,uses:0,maxUses,created:new Date().toISOString(),createdBy:appData.user.id}); saveData(); updateAdminStats(); if(tg){ tg.showAlert(`✅ Промокод "${code}" создан!\nНаграда: ${reward} монет\nИспользований: ${maxUses}`);} else { alert(`✅ Промокод "${code}" создан!\nНаграда: ${reward} монет\nИспользований: ${maxUses}`);} }
    function showUserManagement(){ if(!appData.users.length){ alert('👥 Пользователи не найдены'); return; } let list='Выберите пользователя для управления:\n\n'; appData.users.forEach((u,i)=>{ const la=u.lastActive?new Date(u.lastActive).toLocaleDateString():'Никогда'; list+=`${i+1}. ${u.name}\n   ID: ${u.id}\n   Баланс: ${u.balance||0}\n   Билеты: ${u.tickets||0}\n   Последняя активность: ${la}\n\n`; }); const idx=parseInt(prompt(list+'Введите номер пользователя:'))-1; if(idx>=0&&idx<appData.users.length){ manageSpecificUser(appData.users[idx]); } }
    function manageSpecificUser(user){ const a=prompt(`Управление пользователем ${user.name}:\n\n1 - Добавить баланс\n2 - Списать баланс\n3 - Добавить билеты\n4 - Заблокировать\n5 - Удалить\n\nВведите номер действия:`); if(a==='1'){ const v=parseInt(prompt('Сколько монет добавить:')); if(v>0){ user.balance=(user.balance||0)+v; saveData(); alert(`✅ Добавлено ${v} монет пользователю ${user.name}`);} } else if(a==='2'){ const v=parseInt(prompt('Сколько монет списать:')); if(v>0){ user.balance=Math.max(0,(user.balance||0)-v); saveData(); alert(`✅ Списано ${v} монет у пользователя ${user.name}`);} } else if(a==='3'){ const v=parseInt(prompt('Сколько билетов добавить:')); if(v>0){ user.tickets=(user.tickets||0)+v; saveData(); alert(`✅ Добавлено ${v} билетов пользователю ${user.name}`);} } else if(a==='4'){ user.blocked=!user.blocked; saveData(); alert(`✅ Пользователь ${user.name} ${user.blocked?'заблокирован':'разблокирован'}`);} else if(a==='5'){ if(confirm(`Удалить пользователя ${user.name}?`)){ appData.users=appData.users.filter(u=>u.id!==user.id); saveData(); alert(`✅ Пользователь ${user.name} удален`);} } }
    function showPromoManagement(){ if(!appData.promos.length){ alert('🎫 Промокоды не найдены'); return; } let list='Управление промокодами:\n\n'; appData.promos.forEach((p,i)=>{ list+=`${i+1}. ${p.code}\n   Награда: ${p.reward}\n   Использовано: ${p.uses}/${p.maxUses}\n   Создан: ${new Date(p.created).toLocaleDateString()}\n\n`; }); const idx=parseInt(prompt(list+'Введите номер для удаления (или 0 для отмены):'))-1; if(idx>=0&&idx<appData.promos.length){ if(confirm(`Удалить промокод "${appData.promos[idx].code}"?`)){ appData.promos.splice(idx,1); saveData(); alert('✅ Промокод удален'); } } }
    function showLinkManagement(){ const p=prompt('Какую ссылку изменить?\n\n1 - Telegram\n2 - AppGallery\n3 - RuStore\n\nВведите номер:'); let cur='',key=''; if(p==='1'){cur=appData.settings.downloadLinks.telegram;key='telegram';} else if(p==='2'){cur=appData.settings.downloadLinks.appgallery;key='appgallery';} else if(p==='3'){cur=appData.settings.downloadLinks.rustore;key='rustore';} else {return;} const nl=prompt(`Текущая ссылка:\n${cur}\n\nВведите новую ссылку:`); if(nl){ appData.settings.downloadLinks[key]=nl; saveData(); alert('✅ Ссылка обновлена'); } }
    function exportData(){ const data={ users: appData.users, promos: appData.promos, statistics: { totalUsers: appData.users.length, totalBalance: appData.users.reduce((s,u)=>s+(u.balance||0),0), activeToday: appData.users.filter(u=>u.lastActive && new Date(u.lastActive).toDateString()===new Date().toDateString()).length, exportDate: new Date().toISOString() } }; const dataStr=JSON.stringify(data,null,2); if(tg){ tg.sendData(dataStr);} else { alert('📊 Данные экспортированы в консоль браузера'); console.log('Экспорт данных:', data); } }
    function openModal(id){ document.getElementById(id).style.display='flex'; }
    function closeModal(id){ document.getElementById(id).style.display='none'; }
    function openStorage(){ if(!appData.user.inventory||appData.user.inventory.length===0){ alert('📦 Ваше хранилище пусто\n\nПокупайте товары в магазине!'); return; } let list='📦 ХРАНИЛИЩЕ ПРЕДМЕТОВ\n\n'; const st={pending:'⏳ Ожидает вывода',processing:'🔄 В обработке',delivered:'✅ Доставлено'}; appData.user.inventory.forEach((it,i)=>{ const d=new Date(it.purchaseDate).toLocaleDateString(); list+=`${i+1}. ${it.item}\n   Категория: ${it.category}\n   Куплено: ${d}\n   Статус: ${st[it.status]||'❓ Неизвестно'}\n\n`; }); list+='Все выводы товаров происходят каждый понедельник с 00:00 по 23:00\n\nPowered by Atrium Online'; alert(list); }
    function generateBonusCalendar(){ const grid=document.getElementById('bonusGrid'); const rewards=[5,10,15,15,15,15,15,15,15]; grid.innerHTML=''; for(let i=1;i<=9;i++){ const el=document.createElement('div'); el.className='bonus-day'; if(i<=appData.user.bonusDays){ el.classList.add('claimed'); } else if(i===appData.user.bonusDays+1 && canClaimBonus()){ el.classList.add('active'); el.onclick=()=>claimBonus(i); } el.innerHTML=`<div class="bonus-day-number">${i} ДЕНЬ</div><div class="bonus-reward"><div class="coin-icon">₽</div><span>${rewards[i-1]}</span></div>`; grid.appendChild(el);} updateBonusTimer(); const bar=document.getElementById('bonusProgressBar'); if(bar){ bar.style.width=Math.min(100,(appData.user.bonusDays/9)*100)+'%'; } }
    function canClaimBonus(){ const now=new Date(); const last=appData.user.lastBonusDate?new Date(appData.user.lastBonusDate):null; if(!last) return true; const diff= (now.getTime()-last.getTime())/(1000*3600); return diff>=24; }
    function claimBonus(day){ if(!canClaimBonus()){ showNotification('❌ Бонус ещё не доступен!','error'); return; } const rewards=[5,10,15,15,15,15,15,15,15]; const reward=rewards[day-1]; appData.user.balance+=reward; appData.user.bonusDays=Math.max(appData.user.bonusDays,day); appData.user.lastBonusDate=new Date().toISOString(); if(day===7){ appData.user.balance+=50; showNotification(`🎉 Недельный бонус!\nВы получили ${reward} + 50 (недельный бонус) = ${reward+50} монет!`,'success'); } else if(day===9){ appData.user.tickets+=1; showNotification(`🎊 Полная серия!\nВы получили ${reward} монет + 1 билет!`,'success'); } else { showNotification(`🎉 Ежедневный бонус!\nВы получили ${reward} монет!`,'success'); } saveData(); updateUI(); generateBonusCalendar(); logUserActivity(`bonus_day_${day}`); triggerHaptic('medium'); triggerConfetti(); }
    window.addEventListener('load',()=>{ loadData(); if(appData.user.id){ let u=appData.users.find(x=>x.id===appData.user.id); if(!u){ u={ id:appData.user.id, name:appData.user.name, balance:appData.user.balance, tickets:appData.user.tickets, joinDate:new Date().toISOString(), lastActive:new Date().toISOString(), bonusDays:appData.user.bonusDays, usedPromos:appData.user.usedPromos, inventory: appData.user.inventory||[], activities: [] }; appData.users.push(u);} else { u.name=appData.user.name; u.lastActive=new Date().toISOString(); u.balance=appData.user.balance; u.tickets=appData.user.tickets; } saveData(); } setInterval(()=>{ if(document.getElementById('leaderboardModal').style.display==='flex'){ generateLeaderboard(); } },30000); });
    function updateBonusTimer(){ const el=document.getElementById('bonusTimer'); if(!appData.user.lastBonusDate){ el.textContent='Бонус доступен сейчас!'; return; } const last=new Date(appData.user.lastBonusDate); const next=new Date(last.getTime()+24*60*60*1000); const now=new Date(); if(now>=next){ el.textContent='Бонус доступен сейчас!'; return; } const diff=next.getTime()-now.getTime(); const h=Math.floor(diff/(1000*60*60)); const m=Math.floor((diff%(1000*60*60))/(1000*60)); const s=Math.floor((diff%(1000*60))/1000); el.textContent=`Можно забрать бонус через: ${h}ч. ${m}м. ${s}сек.`; }
    function generateLeaderboard(){ const list=document.getElementById('leaderboardList'); list.innerHTML=''; let players=[...appData.leaderboard]; appData.users.forEach(u=>{ if(u.balance>0){ players=players.filter(p=>p.name.toUpperCase()!==u.name.toUpperCase()); players.push({ name:u.name.toUpperCase(), score:u.balance, avatar:getUserAvatar(u.name), isReal:true, id:u.id, lastActive:u.lastActive }); }}); players.sort((a,b)=>{ if(b.score!==a.score) return b.score-a.score; if(a.isReal&&!b.isReal) return -1; if(!a.isReal&&b.isReal) return 1; return 0; }); const top=players.slice(0,50); top.forEach((p,i)=>{ const el=document.createElement('div'); el.className='leaderboard-item'; if(p.id===appData.user.id){ el.style.background='linear-gradient(45deg, rgba(241,196,15,.2), rgba(243,156,18,.2))'; el.style.border='2px solid #f1c40f'; } let rs=''; if(i===0) rs='color:#f1c40f;font-size:20px;'; else if(i===1) rs='color:#95a5a6;font-size:18px;'; else if(i===2) rs='color:#e67e22;font-size:16px;'; el.innerHTML=`<div class="rank" style="${rs}">#${i+1}</div><div class="player-avatar">${p.avatar}</div><div class="player-info"><div class="player-name">${p.name} ${p.isReal?'<span style="color:#2ecc71;font-size:12px;">●</span>':'<span style="color:#95a5a6;font-size:12px;">○</span>'}</div><div class="player-score"><div class="coin-icon">₽</div><span>+${p.score}</span>${p.lastActive?`<span style="font-size:10px;color:#95a5a6;margin-left:5px;">${getTimeAgo(p.lastActive)}</span>`:''}</div></div>`; list.appendChild(el); }); const title=document.querySelector('#leaderboardModal .modal-title'); if(title){ title.textContent=`ТОП АКТИВНЫХ ИГРОКОВ (${top.length})`; } }
    function getUserAvatar(name){ const avatars=['🎮','💎','👔','💀','⚽','🎯','🚀','⭐','🔥','💫','🎪','🎨','🎭','🎪','🏆']; const hash=name.split('').reduce((h,c)=>h+c.charCodeAt(0),0); return avatars[hash % avatars.length]; }
    function getTimeAgo(ds){ const now=new Date(); const d=new Date(ds); const diff=now-d; const mins=Math.floor(diff/60000); const hrs=Math.floor(diff/3600000); const days=Math.floor(diff/86400000); if(mins<1) return 'сейчас'; if(mins<60) return `${mins}м`; if(hrs<24) return `${hrs}ч`; if(days<7) return `${days}д`; return 'давно'; }
    function handleLogoClick(){ if(appData.user.isAdmin){ toggleAdminPanel(); return; } appData.adminClicks++; if(appData.adminClicks>=7){ alert('🎊 Поздравляем!\n\nВы нашли секретную пасхалку!\n\n+50 монет к балансу!'); appData.user.balance+=50; appData.adminClicks=0; saveData(); updateUI(); logUserActivity('easter_egg'); triggerHaptic('light'); triggerConfetti(); } }
    function activatePromo(){ const code=document.getElementById('promoInput').value.trim().toUpperCase(); if(!code){ showNotification('❌ Введите промокод!','error'); return; } if(appData.user.usedPromos.includes(code)){ showNotification('❌ Промокод уже использован!','error'); return; } const promo=appData.promos.find(p=>p.code.toUpperCase()===code); if(!promo){ showNotification('❌ Промокод не найден!','error'); return; } if(promo.uses>=promo.maxUses){ showNotification('❌ Промокод исчерпан!','error'); return; } appData.user.balance+=promo.reward; appData.user.usedPromos.push(code); promo.uses++; saveData(); updateUI(); closeModal('promoModal'); logUserActivity(`promo_${code}`); showNotification(`🎉 Промокод активирован!\nПолучено ${promo.reward} монет!`,'success'); document.getElementById('promoInput').value=''; triggerHaptic('medium'); triggerConfetti(); }
    function showNotification(msg,type='info'){ if(tg){ if(type==='error'){ tg.showAlert(msg);} else { tg.showPopup({title:type==='success'?'Успех!':'Уведомление', message:msg, buttons:[{type:'ok'}]}); } } else { showToast(msg,type); } }
    function downloadTelegram(){ const link=appData.settings.downloadLinks.telegram; if(tg){ tg.openLink(link);} else { window.open(link,'_blank'); } logUserActivity('download_telegram'); }
    function downloadAppGallery(){ const link=appData.settings.downloadLinks.appgallery; if(tg){ tg.openLink(link);} else { window.open(link,'_blank'); } logUserActivity('download_appgallery'); }
    function downloadRuStore(){ const link=appData.settings.downloadLinks.rustore; if(tg){ tg.openLink(link);} else { window.open(link,'_blank'); } logUserActivity('download_rustore'); }
    function logUserActivity(action){ if(!appData.user.id) return; const u=appData.users.find(x=>x.id===appData.user.id); if(u){ u.lastActive=new Date().toISOString(); if(!u.activities) u.activities=[]; u.activities.push({action, timestamp:new Date().toISOString()}); if(u.activities.length>50){ u.activities=u.activities.slice(-50);} saveData(); } }
    function openCategory(c){ const names={transport:'УНИКАЛЬНЫЙ ТРАНСПОРТ', skins:'УНИКАЛЬНЫЕ СКИНЫ', items:'УНИКАЛЬНЫЕ ПРЕДМЕТЫ', currency:'ВИРТУАЛЬНАЯ ВАЛЮТА'}; alert(`🛍️ ${names[c]}\n\nВсе выводы товаров происходят каждый понедельник с 00:00 по 23:00\n\nPowered by Atrium Online`); }
    function resetLeaderboard(){ if(!appData.user.isAdmin){ showNotification('❌ Нет доступа!','error'); return; } const ok=confirm('🔄 СБРОС ЛИДЕРБОРДА\n\nВы уверены, что хотите:\n\n1. Обнулить баланс всех пользователей\n2. Сбросить бонусные дни\n3. Очистить инвентари\n4. Начать топ с нуля\n\nЭТО ДЕЙСТВИЕ НЕОБРАТИМО!'); if(!ok) return; const dc=prompt('Для подтверждения введите "RESET":'); if(dc!=='RESET'){ alert('❌ Сброс отменен'); return; } appData.users.forEach(u=>{ u.balance=0; u.tickets=0; u.bonusDays=0; u.lastBonusDate=null; u.usedPromos=[]; u.inventory=[]; u.activities=[]; }); appData.user.balance=0; appData.user.tickets=0; appData.user.bonusDays=0; appData.user.lastBonusDate=null; appData.user.usedPromos=[]; appData.user.inventory=[]; appData.leaderboard=[ {name:'ZUZULKO',score:787,avatar:'🎮'}, {name:'SUXIZSCX',score:214,avatar:'💎'}, {name:'GIG0344',score:206,avatar:'👔'}, {name:'OLEG ALEKSEEV',score:153,avatar:'💀'}, {name:'WERT4567889',score:132,avatar:'⚽'} ]; saveData(); updateUI(); generateBonusCalendar(); generateLeaderboard(); updateAdminStats(); showNotification('✅ Лидерборд успешно сброшен!\n\nВсе пользователи начинают с нуля.','success'); }
    function manageLeaderboard(){ if(!appData.user.isAdmin) return; const a=prompt('🏆 УПРАВЛЕНИЕ ЛИДЕРБОРДОМ\n\n1 - Добавить фейкового игрока\n2 - Удалить фейкового игрока\n3 - Изменить баланс игрока\n4 - Полный сброс лидерборда\n5 - Обновить в реальном времени\n\nВведите номер действия:'); if(a==='1'){ addFakePlayer(); } else if(a==='2'){ removeFakePlayer(); } else if(a==='3'){ editPlayerBalance(); } else if(a==='4'){ resetLeaderboard(); } else if(a==='5'){ generateLeaderboard(); showNotification('✅ Лидерборд обновлен','success'); } }
    function addFakePlayer(){ const name=prompt('Введите имя игрока:'); if(!name) return; const score=parseInt(prompt('Введите баланс:')); if(!score||score<0) return; const avatars=['🎮','💎','👔','💀','⚽','🎯','🚀','⭐','🔥','💫']; const avatar=avatars[Math.floor(Math.random()*avatars.length)]; appData.leaderboard.push({name:name.toUpperCase(),score,avatar,isReal:false}); saveData(); generateLeaderboard(); showNotification(`✅ Игрок ${name} добавлен в лидерборд`,'success'); }
    function removeFakePlayer(){ const fps=appData.leaderboard.filter(p=>!p.isReal); if(fps.length===0){ alert('❌ Нет фейковых игроков для удаления'); return; } let list='Выберите игрока для удаления:\n\n'; fps.forEach((p,i)=>{ list+=`${i+1}. ${p.name} (${p.score})\n`; }); const idx=parseInt(prompt(list+'\nВведите номер:'))-1; if(idx>=0&&idx<fps.length){ const rm=fps[idx]; appData.leaderboard=appData.leaderboard.filter(p=>p!==rm); saveData(); generateLeaderboard(); showNotification(`✅ Игрок ${rm.name} удален`,'success'); } }
    function editPlayerBalance(){ let all=[...appData.leaderboard]; appData.users.forEach(u=>{ if(u.balance>0){ all.push({name:u.name,score:u.balance,isReal:true,userData:u}); } }); if(all.length===0){ alert('❌ Нет игроков в лидерборде'); return; } let list='Выберите игрока:\n\n'; all.forEach((p,i)=>{ list+=`${i+1}. ${p.name} - ${p.score} ${p.isReal?'(реальный)':'(фейковый)'}\n`; }); const idx=parseInt(prompt(list+'\nВведите номер:'))-1; if(idx>=0&&idx<all.length){ const p=all[idx]; const nb=parseInt(prompt(`Новый баланс для ${p.name}:`)); if(nb>=0){ if(p.isReal&&p.userData){ p.userData.balance=nb; if(p.userData.id===appData.user.id){ appData.user.balance=nb; updateUI(); } } else { const fp=appData.leaderboard.find(x=>x.name===p.name); if(fp) fp.score=nb; } saveData(); generateLeaderboard(); showNotification(`✅ Баланс игрока ${p.name} изменен на ${nb}`,'success'); } } }
    function closeApp(){ if(tg){ tg.close(); } }
    setInterval(updateBonusTimer,1000);
    window.addEventListener('beforeunload',()=>{ if(appData.user.id){ const u=appData.users.find(x=>x.id===appData.user.id); if(u){ u.balance=appData.user.balance; u.tickets=appData.user.tickets; u.bonusDays=appData.user.bonusDays; u.usedPromos=appData.user.usedPromos; u.inventory=appData.user.inventory; u.lastActive=new Date().toISOString(); } } saveData(); });
    setInterval(()=>{ if(appData.user.id){ const u=appData.users.find(x=>x.id===appData.user.id); if(u){ u.balance=appData.user.balance; u.tickets=appData.user.tickets; u.bonusDays=appData.user.bonusDays; u.usedPromos=appData.user.usedPromos; u.inventory=appData.user.inventory; u.lastActive=new Date().toISOString(); } saveData(); } },30000);
    document.addEventListener('click',e=>{ if(e.target.classList.contains('modal')){ e.target.style.display='none'; } });
    document.addEventListener('click',e=>{ const mc=e.target.closest('.modal-content'); if(mc){ e.stopPropagation(); } });
    </script>

    <script>
    (function(){
        const tg = window.Telegram?.WebApp;
        document.addEventListener('click',(e)=>{ const t=e.target.closest('.action-btn,.bottom-btn,.download-btn,.admin-btn,.shop-category,.grid-item'); if(!t) return; const r=t.getBoundingClientRect(); const s=document.createElement('span'); s.className='ripple'; const size=Math.max(r.width,r.height); s.style.width=s.style.height=size+'px'; s.style.left=(e.clientX-r.left-size/2)+'px'; s.style.top=(e.clientY-r.top-size/2)+'px'; t.appendChild(s); setTimeout(()=>s.remove(),600); });
        let canvas, ctx, animId=null; function setupCanvas(){ if(document.getElementById('effectsCanvas')) return; canvas=document.createElement('canvas'); canvas.id='effectsCanvas'; document.body.appendChild(canvas); ctx=canvas.getContext('2d'); resize(); window.addEventListener('resize',resize); }
        function resize(){ if(!canvas) return; const dpr=Math.max(1,window.devicePixelRatio||1); canvas.width=Math.floor(window.innerWidth*dpr); canvas.height=Math.floor(window.innerHeight*dpr); canvas.style.width='100%'; canvas.style.height='100%'; if(ctx) ctx.setTransform(dpr,0,0,dpr,0,0); }
        function triggerConfetti(){ if(!ctx) return; const colors=['#f1c40f','#e67e22','#9b59b6','#2ecc71','#3498db','#e74c3c']; const parts=[]; const cnt=100; const ox=window.innerWidth/2, oy=window.innerHeight/3; for(let i=0;i<cnt;i++){ parts.push({ x:ox+(Math.random()-0.5)*80, y:oy+(Math.random()-0.5)*40, vx:(Math.random()-0.5)*6, vy:Math.random()*-6-4, size:Math.random()*6+3, color:colors[Math.floor(Math.random()*colors.length)], rot:Math.random()*Math.PI, vr:(Math.random()-0.5)*0.3, life:1 }); }
            const start=performance.now(); cancelAnimationFrame(animId); function frame(now){ const t=(now-start)/1200; ctx.clearRect(0,0,window.innerWidth,window.innerHeight); parts.forEach(p=>{ p.vy+=0.15; p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.life=Math.max(0,1-t); ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.globalAlpha=p.life; ctx.fillStyle=p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size); ctx.restore(); }); if(t<1){ animId=requestAnimationFrame(frame);} else { ctx.clearRect(0,0,window.innerWidth,window.innerHeight); } } animId=requestAnimationFrame(frame); }
        function showToast(msg,type='info'){ let c=document.getElementById('toastContainer'); if(!c){ c=document.createElement('div'); c.id='toastContainer'; c.style.position='fixed'; c.style.left='50%'; c.style.bottom='24px'; c.style.transform='translateX(-50%)'; c.style.zIndex='3000'; document.body.appendChild(c);} const t=document.createElement('div'); t.className='toast '+type; t.textContent=msg; c.appendChild(t); requestAnimationFrame(()=>t.classList.add('show')); setTimeout(()=>{ t.classList.add('hide'); setTimeout(()=>t.remove(),300); },2500); }
        function smoothUpdateNumber(id,val){ const el=document.getElementById(id); if(!el) return; const cur=parseInt((el.textContent||'0').toString().replace(/\D/g,''),10)||0; if(cur===val){ el.textContent=String(val); return; } const dur=600, start=performance.now(), delta=val-cur; function step(now){ const t=Math.min(1,(now-start)/dur); const eased=0.5-Math.cos(Math.PI*t)/2; el.textContent=String(Math.round(cur+delta*eased)); if(t<1) requestAnimationFrame(step);} requestAnimationFrame(step); }
        function triggerHaptic(style='light'){ try{ if(tg && tg.HapticFeedback && typeof tg.HapticFeedback.impactOccurred==='function'){ tg.HapticFeedback.impactOccurred(style); } }catch(e){} }
        function ensureBonusBar(){ const grid=document.getElementById('bonusGrid'); if(!grid) return; if(document.getElementById('bonusProgressBar')) return; const p=document.createElement('div'); p.className='progress'; const b=document.createElement('div'); b.className='progress-bar'; b.id='bonusProgressBar'; p.appendChild(b); grid.parentNode.insertBefore(p,grid); }
        function updateBonusBar(){ const b=document.getElementById('bonusProgressBar'); if(!b) return; b.style.width=Math.min(100,(appData.user.bonusDays/9)*100)+'%'; }
        const originalShow=window.showNotification; window.showNotification=function(m,t='info'){ if(tg) return originalShow(m,t); showToast(m,t); };
        const oldUI=window.updateUI; window.updateUI=function(){ oldUI && oldUI(); smoothUpdateNumber('balance', appData.user.balance); smoothUpdateNumber('tickets', appData.user.tickets); };
        const oldGen=window.generateBonusCalendar; window.generateBonusCalendar=function(){ oldGen(); ensureBonusBar(); updateBonusBar(); };
        const oldPromo=window.activatePromo; window.activatePromo=function(){ oldPromo(); triggerHaptic('medium'); triggerConfetti(); };
        const oldLogo=window.handleLogoClick; window.handleLogoClick=function(){ const before=appData.user.balance; oldLogo(); if(appData.user.balance>before){ triggerHaptic('light'); triggerConfetti(); } };
        function init(){ setupCanvas(); ensureBonusBar(); updateBonusBar(); }
        window.addEventListener('load', init);
        window.triggerConfetti = triggerConfetti;
        window.showToast = showToast;
        window.smoothUpdateNumber = smoothUpdateNumber;
        window.triggerHaptic = triggerHaptic;
    })();
    </script>
</body>
</html>
